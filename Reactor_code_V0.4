-- reactor_code_v0_4
-- cc:tweaked + mekanism fissionreactorlogicadapter
-- full code, with required capitals in method names
-- stable display (no flicker) + percent bars with -

-- ===== config =====
local MONITOR_NAME = "monitor_7"
local REACTOR_NAME = "fissionReactorLogicAdapter_0"
local LOOP_SEC = 0.5
local TEXT_SCALE = 0.5

-- bar layout
local BAR_W = 24
local BAR_X = 10
local LABEL_X = 1
local VALUE_X = BAR_X + BAR_W + 3

-- ===== find peripherals =====
local monitor = peripheral.wrap(MONITOR_NAME) or peripheral.find("monitor")
if not monitor then error("no monitor found") end

local reactor = peripheral.wrap(REACTOR_NAME) or peripheral.find("fissionReactorLogicAdapter")
if not reactor then error("no fissionReactorLogicAdapter found") end

-- ===== helpers =====
local function clamp(v, a, b)
  if v < a then return a end
  if v > b then return b end
  return v
end

local function safeCall(obj, method)
  if not obj or not method then return nil end
  local fn = obj[method]
  if type(fn) ~= "function" then return nil end
  local ok, res = pcall(fn, obj)
  if ok then return res end
  return nil
end

local function padRight(s, n)
  s = tostring(s or "")
  if #s >= n then return s end
  return s .. string.rep(" ", n - #s)
end

local function clearLine(y)
  local w, _ = monitor.getSize()
  monitor.setCursorPos(1, y)
  monitor.write(string.rep(" ", w))
end

local function writeAt(x, y, text)
  monitor.setCursorPos(x, y)
  monitor.write(text)
end

local function setTextColorSafe(color)
  if monitor.setTextColor then monitor.setTextColor(color) end
end

local function setBgColorSafe(color)
  if monitor.setBackgroundColor then monitor.setBackgroundColor(color) end
end

local function drawBar(x, y, w, percent)
  percent = clamp(percent or 0, 0, 100)
  local fill = math.floor((percent / 100) * w + 0.00001)

  writeAt(x, y, "[")
  writeAt(x + 1, y, string.rep("#", fill) .. string.rep("-", w - fill))
  writeAt(x + 1 + w, y, "]")
end

local function fmtPct(v)
  if v == nil then return "n/a" end
  return string.format("%5.1f%%", v)
end

local function fmtTempC(kelvin)
  if kelvin == nil then return "n/a" end
  local c = kelvin - 273.15
  return string.format("%.1f c", c)
end

local function statusToText(st)
  if st == nil then return "n/a" end
  if type(st) == "boolean" then
    return st and "on" or "off"
  end
  return tostring(st)
end

-- ===== init screen (clear once, no flicker) =====
monitor.setTextScale(TEXT_SCALE)
setBgColorSafe(colors.black)
setTextColorSafe(colors.white)
monitor.clear()

writeAt(1, 1, "control fission reactor")
writeAt(1, 2, REACTOR_NAME)

writeAt(1, 4, "state:")
writeAt(1, 5, "temp:")

writeAt(LABEL_X, 7, "coolant")
writeAt(LABEL_X, 8, "fuel")
writeAt(LABEL_X, 9, "waste")
writeAt(LABEL_X, 10, "heated")

writeAt(LABEL_X, 12, "damage:")
writeAt(LABEL_X, 13, "burn:")

-- ===== main loop =====
while true do
  -- read data (keep exact method name capitals)
  local tempK   = safeCall(reactor, "getTemperature")
  local coolant = safeCall(reactor, "getCoolantFilledPercentage")
  local fuel    = safeCall(reactor, "getFuelFilledPercentage")
  local waste   = safeCall(reactor, "getWasteFilledPercentage")
  local heated  = safeCall(reactor, "getHeatedCoolantFilledPercentage")
  local dmg     = safeCall(reactor, "getDamagePercent")
  local burn    = safeCall(reactor, "getActualBurnRate")
  local burnMax = safeCall(reactor, "getMaxBurnRate")
  local st      = safeCall(reactor, "getStatus")

  -- state line
  clearLine(4)
  writeAt(1, 4, "state: " .. statusToText(st))

  -- temp line
  clearLine(5)
  writeAt(1, 5, "temp:  " .. fmtTempC(tempK) .. "   ")

  -- bars
  drawBar(BAR_X, 7, BAR_W, coolant or 0)
  drawBar(BAR_X, 8, BAR_W, fuel or 0)
  drawBar(BAR_X, 9, BAR_W, waste or 0)
  drawBar(BAR_X, 10, BAR_W, heated or 0)

  -- values (right side)
  clearLine(7)
  writeAt(LABEL_X, 7, "coolant")
  writeAt(VALUE_X, 7, fmtPct(coolant))

  clearLine(8)
  writeAt(LABEL_X, 8, "fuel")
  writeAt(VALUE_X, 8, fmtPct(fuel))

  clearLine(9)
  writeAt(LABEL_X, 9, "waste")
  writeAt(VALUE_X, 9, fmtPct(waste))

  clearLine(10)
  writeAt(LABEL_X, 10, "heated")
  writeAt(VALUE_X, 10, fmtPct(heated))

  -- damage
  clearLine(12)
  writeAt(1, 12, "damage: " .. (dmg and string.format("%.1f%%", dmg) or "n/a") .. "   ")

  -- burn
  clearLine(13)
  local burnTxt = "n/a"
  if burn ~= nil and burnMax ~= nil then
    burnTxt = string.format("%.2f / %.2f", burn, burnMax)
  end
  writeAt(1, 13, "burn:   " .. burnTxt .. "   ")

  sleep(LOOP_SEC)
end
```0